/*
 * Ext JS Library 1.0
 * Copyright(c) 2006-2007, Ext JS, LLC.
 * licensing@extjs.com
 * 
 * http://www.extjs.com/license
 */

Ext.grid.HeaderDragZone=function(_1,hd,_3){this.grid=_1;this.view=_1.getView();this.ddGroup="gridHeader"+this.grid.container.id;Ext.grid.HeaderDragZone.superclass.constructor.call(this,hd);this.setHandleElId(Ext.id(hd));this.setOuterHandleElId(Ext.id(_3));this.scroll=false;};Ext.extend(Ext.grid.HeaderDragZone,Ext.dd.DragZone,{maxDragWidth:120,getDragData:function(e){var t=Ext.lib.Event.getTarget(e);var h=this.view.findHeaderCell(t);if(h){return {ddel:h.firstChild,header:h};}return false;},onInitDrag:function(e){var _8=this.dragData.ddel.cloneNode(true);_8.style.width=Math.min(this.dragData.header.offsetWidth,this.maxDragWidth)+"px";this.proxy.update(_8);return true;}});Ext.grid.HeaderDropZone=function(_9,hd,_b){this.grid=_9;this.view=_9.getView();this.proxyTop=Ext.DomHelper.append(document.body,{tag:"div",cls:"col-move-top",html:"&#160;"},true);this.proxyBottom=Ext.DomHelper.append(document.body,{tag:"div",cls:"col-move-bottom",html:"&#160;"},true);this.proxyTop.hide=this.proxyBottom.hide=function(){this.setLeftTop(-100,-100);this.setStyle("visibility","hidden");};this.ddGroup="gridHeader"+this.grid.container.id;Ext.grid.HeaderDropZone.superclass.constructor.call(this,_9.container.dom);};Ext.extend(Ext.grid.HeaderDropZone,Ext.dd.DropZone,{proxyOffsets:[-4,-9],fly:Ext.Element.fly,getTargetFromEvent:function(e){var t=Ext.lib.Event.getTarget(e);var _e=this.view.findCellIndex(t);if(_e!==false){return this.view.getHeaderCell(_e);}},nextVisible:function(h){var v=this.view,cm=this.grid.colModel;h=h.nextSibling;while(h){if(!cm.isHidden(v.getCellIndex(h))){return h;}h=h.nextSibling;}return null;},prevVisible:function(h){var v=this.view,cm=this.grid.colModel;h=h.prevSibling;while(h){if(!cm.isHidden(v.getCellIndex(h))){return h;}h=h.prevSibling;}return null;},positionIndicator:function(h,n,e){var x=Ext.lib.Event.getPageX(e);var r=Ext.lib.Dom.getRegion(n.firstChild);var px,pt,py=r.top+this.proxyOffsets[1];if((r.right-x)<=(r.right-r.left)/2){px=r.right+this.view.borderWidth;pt="after";}else{px=r.left;pt="before";}var _1d=this.view.getCellIndex(h);var _1e=this.view.getCellIndex(n);var _1f=this.grid.colModel.isLocked(_1e);if(pt=="after"){_1e++;}if(_1d<_1e){_1e--;}if(_1d==_1e&&(_1f==this.grid.colModel.isLocked(_1d))){return false;}px+=this.proxyOffsets[0];this.proxyTop.setLeftTop(px,py);this.proxyTop.show();if(!this.bottomOffset){this.bottomOffset=this.view.mainHd.getHeight();}this.proxyBottom.setLeftTop(px,py+this.proxyTop.dom.offsetHeight+this.bottomOffset);this.proxyBottom.show();return pt;},onNodeEnter:function(n,dd,e,_23){if(_23.header!=n){this.positionIndicator(_23.header,n,e);}},onNodeOver:function(n,dd,e,_27){var _28=false;if(_27.header!=n){_28=this.positionIndicator(_27.header,n,e);}if(!_28){this.proxyTop.hide();this.proxyBottom.hide();}return _28?this.dropAllowed:this.dropNotAllowed;},onNodeOut:function(n,dd,e,_2c){this.proxyTop.hide();this.proxyBottom.hide();},onNodeDrop:function(n,dd,e,_30){var h=_30.header;if(h!=n){var cm=this.grid.colModel;var x=Ext.lib.Event.getPageX(e);var r=Ext.lib.Dom.getRegion(n.firstChild);var pt=(r.right-x)<=((r.right-r.left)/2)?"after":"before";var _36=this.view.getCellIndex(h);var _37=this.view.getCellIndex(n);var _38=cm.isLocked(_37);if(pt=="after"){_37++;}if(_36<_37){_37--;}if(_36==_37&&(_38==cm.isLocked(_36))){return false;}cm.setLocked(_36,_38,true);cm.moveColumn(_36,_37);this.grid.fireEvent("columnmove",_36,_37);return true;}return false;}});
