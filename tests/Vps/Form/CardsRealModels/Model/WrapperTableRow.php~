<?
class Vps_Form_CardsRealModels_Model_WrapperTableRow extends Vps_Db_Table_Row
{
    public function findParentUserRow()
    {
        $userModel = Vps_Registry::get('userModel');
        return $userModel->getRow($this->user_id);
    }

    public function getOverviewData()
    {
        $ret = new stdClass();
        $ret->type = $this->type;
        $ret->comment = $this->comment;
        if ($this->type == 'storage') {
            $t = new BookingServiceStorage();
            $row = $t->find($this->id)->current();
            $ret->box_nr = $row->box_nr;
            $ret->deposit = $row->deposit;
            $ret->deposit_returned = (boolean) $row->deposit_returned;
        } else if ($this->type == 'course') {
            $t = new BookingServiceCourse();
            $row = $t->find($this->id)->current();
            $ret->beginning_date = $row->beginning_date;
            $ret->beginning_time = $row->beginning_time;
            $ret->language = $row->findParentRow('Languages')->__toString();
            $ret->course_type = $row->findParentRow('CourseTypes')->__toString();
        } else if ($this->type == 'rent') {
            $t = new BookingServiceRent();
            $row = $t->find($this->id)->current();
            $ret->rent_type = $row->findParentRow('Renttypes')->__toString();
            $ret->kitelevel = $row->findParentRow('Kitelevels')->__toString();
            $ret->begin = $row->begin;
            $ret->end = $row->end;
        } else if ($this->type == 'transfer') {
            $t = new BookingServiceTransfer();
            $row = $t->find($this->id)->current();
            foreach ($row->toArray() as $k=>$i) {
                $ret->$k = $i;
            }
        } else if ($this->type == 'boat_trip') {
            $t = new BookingServiceBoatTrip();
            $row = $t->find($this->id)->current();
            $ret->age = $row->age;
            $ret->kiter = $row->kiter;
            $ret->boat_trip = $row->findParentRow('BoatTrips')->__toString();
            $ret->boat_trip_duration = $row->findParentRow('BoatTrips')->duration;
        }
        return $ret;
    }
}
